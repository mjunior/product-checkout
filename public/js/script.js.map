{"version":3,"sources":["../../src/js/script.js"],"names":["Util","amount","decimalCount","decimal","thousands","isNaN","format","minimumFractionDigits","style","currency","toLocaleString","EnjoeiModal","title","text","Swal","fire","showCloseButton","showCancelButton","showConfirmButton","width","customClass","container","popup","header","closeButton","image","content","input","actions","confirmButton","cancelButton","footer","ActionButtons","document","getElementById","_bind_click_buttons","modal","onclick","confirm","cancel","PathParam","array","window","location","pathname","split","filter","item","result","i","length","SummarySection","fields","_print","totalPrice","bold","shippingPrice","price","hasVoucher","cupom","cupons","find","id","voucher_id","discount","accent","value","opts","element","querySelector","innerText","formatMoney","className","classList","add","CupomSection","couponSectionList","cupomAmountDetail","unshift","voucherOnScreen","querySelectorAll","innerHTML","forEach","html","appendChild","el","onchange","LoadCheckoutPage","params","checkout","div","createElement","htmlString","trim","firstChild","checkout_id","perform","url","concat","fetch","then","json","product","availableCoupons","console","log","summarySection","cupomSection","printAll","printAvailables","bindChanges","$","ready"],"mappings":"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","sourcesContent":["class Util{\n  static formatMoney(amount, decimalCount = 2, decimal = \",\", thousands = \".\") {\n    if(isNaN(amount)){  \n      return \"\"\n    }\n    const format = { minimumFractionDigits: 2, style: 'currency', currency: 'BRL' }\n    return amount.toLocaleString('pt-BR', format);\n  }\n}\n//ModalScript\nclass EnjoeiModal {\n  constructor(title, text){\n    this.title = title;\n    this.text = text;\n  }\n  \n  fire(){\n    Swal.fire({\n      title: this.title || 'compra efetuada',\n      text: this.text || 'enviaremos informacoes por email',\n      showCloseButton: false,\n      showCancelButton: false,\n      showConfirmButton: false,\n      width: '370px',\n      customClass: {\n        container: 'enjoei-modal-container-class',\n        popup: 'enjoei-modal-popup-class',\n        header: 'enjoei-modal-header-class',\n        title: 'enjoei-modal-title-class',\n        closeButton: 'enjoei-modal-close-button-class',\n        image: 'enjoei-modal-image-class',\n        content: 'enjoei-modal-content-class',\n        input: 'enjoei-modal-input-class',\n        actions: 'enjoei-modal-actions-class',\n        confirmButton: 'enjoei-modal-confirm-button-class',\n        cancelButton: 'enjoei-modal-cancel-button-class',\n        footer: 'enjoei-modal-footer-class'\n      }\n    });\n  }\n}\n//ButtonScript\nclass ActionButtons{\n  constructor() {\n    this.confirmButton = document.getElementById('confirm-button');\n    this.cancelButton = document.getElementById('cancel-button');\n    this._bind_click_buttons();\n  }\n\n  confirm() {\n    const title = 'compra confirmada';\n    const text = 'entraremos em contato po email';\n    const modal = new EnjoeiModal(title, text)\n    modal.fire()\n  }\n\n  cancel() {\n    const title = 'compra cancelada';\n    const text = 'pedido não foi enviado, você não sera cobrado'\n    const modal = new EnjoeiModal(title,text)\n    modal.fire()\n  }\n\n  _bind_click_buttons(){\n    this.confirmButton.onclick = this.confirm\n    this.cancelButton.onclick = this.cancel\n  }\n}\n//PathParamRouter\nclass PathParam {\n  static params() {\n    const array = window.location.pathname.split('/').filter(item => item !== \"\")\n    const result = {}\n    for (let i = 0; i < array.length; i = i + 2) {\n      result[array[i]] = array[i + 1];\n    }\n    return result;\n  }\n}\n//Summary\nclass SummarySection{\n  constructor(fields){\n    this.fields = fields\n  }\n\n  printAll(){\n    this._print('amount-total', this.fields.totalPrice, { bold: true });\n    this._print('amount-shipping', this.fields.shippingPrice);\n    this._print('amount-original', this.fields.price);\n    \n    //if there are more one available voucher, find the correct\n    if(this.fields.hasVoucher === true){\n      const cupom = this.fields.cupons.find(cupom => {\n        return cupom.id == this.fields.voucher_id\n      })\n      this._print('amount-discount', cupom.discount * -1,{accent: true});\n    }else{\n      this._print('amount-discount', 0);\n    }\n  }\n  \n  _print(id, value, opts = {}){\n    const element = document.querySelector(`#${id}`)\n    element.innerText = Util.formatMoney(value)\n    element.className = '';\n\n    if(opts.accent)\n      element.classList.add(\"accent-text\");\n      \n    if (opts.bold) \n      element.classList.add(\"bold-text\");\n  }\n}\n\n//Cupons\nclass CupomSection{\n  constructor(cupons){\n    this.cupons = cupons;\n    this.couponSectionList = document.getElementById('coupons-list');\n    this.cupomAmountDetail = document.getElementById('amount-cupom-detail');\n    if(!cupons || cupons.length === 0){\n      document.getElementById('coupon-section').classList.add(\"hide\")\n      this.couponSectionList.classList.add(\"hide\");\n      this.cupomAmountDetail.classList.add(\"hide\");\n      return\n    }\n\n    this.cupons.unshift({\n      id: -1,\n      title: 'não usar cupom'\n    })\n  }\n  \n  printAvailables(){\n    const voucherOnScreen = document.querySelectorAll(\".voucher-item\").length\n    //return if all vouchers are on the screen\n    if(voucherOnScreen === this.cupons.length){\n      return\n    }\n    this.couponSectionList.innerHTML = \"\"\n    this.cupons.forEach(cupom => {\n      let html = this._print(cupom)\n      this.couponSectionList.appendChild(html)\n    });\n  }\n\n  bindChanges(){\n    document.querySelectorAll(\"input[name='voucher']\").forEach(function (el) {\n      el.onchange = function(){\n        const voucher_id = document.querySelector(\"input[name='voucher']:checked\").value\n        new LoadCheckoutPage(PathParam.params().checkout, voucher_id);\n      }\n    })\n  }\n  \n  _print(cupom){\n    const div = document.createElement('div');\n    const htmlString = `<div class=\"item-detail voucher-item\">\n      <label class=\"radio-button row x-between\">${cupom.title}\n      <input type=\"radio\" name=\"voucher\" value=\"${cupom.id}\">\n      <span class=\"checkmark\"></span>\n      <span class=\"accent-text\">${Util.formatMoney(cupom.discount * -1)}</span>\n      </label>\n    </div>`\n    div.innerHTML = htmlString.trim();\n    return div.firstChild\n  }\n}\n\n//Load checkout page\nclass LoadCheckoutPage{\n  constructor(checkout_id, voucher_id = -1){\n    this.checkout_id = checkout_id;\n    this.voucher_id = voucher_id;\n    this.hasVoucher = false;\n    this.perform();\n  }\n\n  perform(){\n    let url = `/api/checkouts/${this.checkout_id}`\n    if(this.voucher_id != -1){\n      url = url.concat(`?couponId=${this.voucher_id}`);\n    }\n    fetch(url)\n      .then((result) => result.json())\n      .then((result) => {\n        let fields = {\n          shippingPrice: result.checkout.shippingPrice,\n          totalPrice: result.checkout.totalPrice,\n          price: result.product.price,\n          image: result.product.image,\n          cupons: result.checkout.availableCoupons,\n        }\n        console.log('this',this.voucher_id)\n        if(this.voucher_id != -1){\n          fields = {\n            ...fields,\n            hasVoucher: true,\n            voucher_id: this.voucher_id\n          }\n        }\n\n        const summarySection  = new SummarySection(fields)\n        const cupomSection = new CupomSection(fields.cupons)\n        summarySection.printAll();\n        \n        cupomSection.printAvailables();\n        cupomSection.bindChanges();\n      })\n  }\n\n}\n\n$(document).ready(() =>{\n  new LoadCheckoutPage(PathParam.params().checkout);\n  new ActionButtons();\n})"],"file":"script.js"}