"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Util=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"formatMoney",value:function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1],2<arguments.length&&void 0!==arguments[2]&&arguments[2],3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(isNaN(e))return"";return e.toLocaleString("pt-BR",{minimumFractionDigits:2,style:"currency",currency:"BRL"})}}]),e}(),EnjoeiModal=function(){function n(e,t){_classCallCheck(this,n),this.title=e,this.text=t}return _createClass(n,[{key:"fire",value:function(){Swal.fire({title:this.title||"compra efetuada",text:this.text||"enviaremos informacoes por email",showCloseButton:!1,showCancelButton:!1,showConfirmButton:!1,width:"370px",customClass:{container:"enjoei-modal-container-class",popup:"enjoei-modal-popup-class",header:"enjoei-modal-header-class",title:"enjoei-modal-title-class",closeButton:"enjoei-modal-close-button-class",image:"enjoei-modal-image-class",content:"enjoei-modal-content-class",input:"enjoei-modal-input-class",actions:"enjoei-modal-actions-class",confirmButton:"enjoei-modal-confirm-button-class",cancelButton:"enjoei-modal-cancel-button-class",footer:"enjoei-modal-footer-class"}})}}]),n}(),ActionButtons=function(){function e(){_classCallCheck(this,e),this.confirmButton=document.getElementById("confirm-button"),this.cancelButton=document.getElementById("cancel-button"),this._bind_click_buttons()}return _createClass(e,[{key:"confirm",value:function(){new EnjoeiModal("compra confirmada","entraremos em contato po email").fire()}},{key:"cancel",value:function(){new EnjoeiModal("compra cancelada","pedido não foi enviado, você não sera cobrado").fire()}},{key:"_bind_click_buttons",value:function(){this.confirmButton.onclick=this.confirm,this.cancelButton.onclick=this.cancel}}]),e}(),PathParam=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"params",value:function(){for(var e=window.location.pathname.split("/").filter(function(e){return""!==e}),t={},n=0;n<e.length;n+=2)t[e[n]]=e[n+1];return t}}]),e}(),SummarySection=function(){function t(e){_classCallCheck(this,t),this.fields=e}return _createClass(t,[{key:"printAll",value:function(){var t=this;if(this._print("amount-total",this.fields.totalPrice,{bold:!0}),this._print("amount-shipping",this.fields.shippingPrice),this._print("amount-original",this.fields.price),!0===this.fields.hasVoucher){var e=this.fields.cupons.find(function(e){return e.id==t.fields.voucher_id});this._print("amount-discount",-1*e.discount,{accent:!0})}else this._print("amount-discount",0)}},{key:"_print",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=document.querySelector("#".concat(e));o.innerText=Util.formatMoney(t),o.className="",n.accent&&o.classList.add("accent-text"),n.bold&&o.classList.add("bold-text")}}]),t}(),CupomSection=function(){function t(e){if(_classCallCheck(this,t),this.cupons=e,this.couponSectionList=document.getElementById("coupons-list"),this.cupomAmountDetail=document.getElementById("amount-cupom-detail"),!e||0===e.length)return document.getElementById("coupon-section").classList.add("hide"),this.couponSectionList.classList.add("hide"),void this.cupomAmountDetail.classList.add("hide");this.cupons.unshift({id:-1,title:"não usar cupom"})}return _createClass(t,[{key:"printAvailables",value:function(){var n=this;document.querySelectorAll(".voucher-item").length!==this.cupons.length&&(this.couponSectionList.innerHTML="",this.cupons.forEach(function(e){var t=n._print(e);n.couponSectionList.appendChild(t)}))}},{key:"bindChanges",value:function(){document.querySelectorAll("input[name='voucher']").forEach(function(e){e.onchange=function(){var e=document.querySelector("input[name='voucher']:checked").value;new LoadCheckoutPage(PathParam.params().checkout,e)}})}},{key:"_print",value:function(e){var t=document.createElement("div"),n='<div class="item-detail voucher-item">\n      <label class="radio-button row x-between">'.concat(e.title,'\n      <input type="radio" name="voucher" value="').concat(e.id,'">\n      <span class="checkmark"></span>\n      <span class="accent-text">').concat(Util.formatMoney(-1*e.discount),"</span>\n      </label>\n    </div>");return t.innerHTML=n.trim(),t.firstChild}}]),t}(),LoadCheckoutPage=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;_classCallCheck(this,n),this.checkout_id=e,this.voucher_id=t,this.hasVoucher=!1,this.perform()}return _createClass(n,[{key:"perform",value:function(){var i=this,e="/api/checkouts/".concat(this.checkout_id);-1!=this.voucher_id&&(e=e.concat("?couponId=".concat(this.voucher_id))),fetch(e).then(function(e){return e.json()}).then(function(e){var t={shippingPrice:e.checkout.shippingPrice,totalPrice:e.checkout.totalPrice,price:e.product.price,image:e.product.image,cupons:e.checkout.availableCoupons};console.log("this",i.voucher_id),-1!=i.voucher_id&&(t=_objectSpread({},t,{hasVoucher:!0,voucher_id:i.voucher_id}));var n=new SummarySection(t),o=new CupomSection(t.cupons);n.printAll(),o.printAvailables(),o.bindChanges()})}}]),n}();$(document).ready(function(){new LoadCheckoutPage(PathParam.params().checkout),new ActionButtons});